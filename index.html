<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (Analytics) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z5NC5MK1Z0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z5NC5MK1Z0');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>404 Not Found</title>
  <style>
    body {
      margin: 0;
      background-color: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }
    h1 { font-size: 3em; margin: 0.2em; }
    p {
      font-size: 1.2em;
      margin-top: 1em;
      cursor: pointer;
      padding: 0.5em 1em;
      background-color: #444;
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    p:hover { background-color: #555; }
  </style>
</head>
<body>

  <h1>404 Not Found</h1>
  <p id="pageDir">page directory</p>

  <script>
    (function () {
      let nCount = 0;
      const targetUrl = '/main.html';

      document.getElementById('pageDir').addEventListener('click', function() {
        alert('Press "n" 4 times to open NebuliOS (embedded in about:blank).');
      });

      document.addEventListener('keydown', async function(event) {
        if (!event.key) return;
        if (event.key.toLowerCase() === 'n') {
          nCount++;
   clearTimeout(window.__nResetTimer);
          window.__nResetTimer = setTimeout(() => { nCount = 0; }, 1000);

          if (nCount === 4) {
            nCount = 0;
            clearTimeout(window.__nResetTimer);

            const newTab = window.open('', '_blank');
            if (!newTab) {
              window.location.href = targetUrl;
              return;
            }

            try {
              const resp = await fetch(targetUrl, { cache: 'no-store' });
              if (!resp.ok) {
                newTab.location.href = targetUrl;
                return;
              }
              let content = await resp.text();

              const baseTag = '<base href="https://google.com">';
              if (/<head[^>]*>/i.test(content)) {
                content = content.replace(/<head([^>]*)>/i, match => match + baseTag);
              } else {
                content = content.replace(/<html([^>]*)>/i, match => match + '<head>' + baseTag + '</head>');
              }

              newTab.document.open();
              newTab.document.write(content);
              newTab.document.close();

              try {
                newTab.document.title = 'New Tab';
              } catch (err) {
                console.warn('Could not set title on injected document:', err);
              }
            } catch (err) {
              console.error('Error injecting main.html into about:blank:', err);
              try { newTab.location.href = targetUrl; } catch (_) { window.location.href = targetUrl; }
            }
          }
        } else {
          nCount = 0;
        }
      });
    })();
  </script>

</body>
</html>
